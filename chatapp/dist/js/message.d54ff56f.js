(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["message"],{"016b":function(t,e,s){"use strict";var n=s("2eeb"),i=s.n(n);i.a},"0cbc":function(t,e,s){"use strict";var n=s("f38d"),i=s.n(n);i.a},"18f0":function(t,e,s){},"1d1c":function(t,e,s){"use strict";var n=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"list-item-wrapper"},[s("div",{staticClass:"avatar-wrapper"},[s("avatar",{attrs:{imgurl:t.avatar}})],1),s("div",{staticClass:"list-item-content"},[s("div",{staticClass:"name"},[t._v(t._s(t.name))]),s("div",{staticClass:"description"},[t._v(t._s(t.desc))])]),s("div",{staticClass:"list-item-extend"},[t._t("extra")],2)])},i=[],a=s("6cc5"),r={props:{avatar:{type:String},name:{type:String},desc:{type:String},uid:{type:String}},components:{Avatar:a["a"]}},o=r,l=(s("0cbc"),s("2877")),c=Object(l["a"])(o,n,i,!1,null,"f0899f76",null);e["a"]=c.exports},2711:function(t,e,s){"use strict";var n=s("575c"),i=s.n(n);i.a},"2eeb":function(t,e,s){},"33a9":function(t,e,s){},"575c":function(t,e,s){},"6cc5":function(t,e,s){"use strict";var n=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"avatar"},[s("img",{directives:[{name:"lazy",rawName:"v-lazy",value:t.imgurl,expression:"imgurl"}],attrs:{alt:""}})])},i=[],a={props:{imgurl:{type:String,default:""}}},r=a,o=(s("2711"),s("2877")),l=Object(o["a"])(r,n,i,!1,null,"28a6aad4",null);e["a"]=l.exports},"7a1a":function(t,e,s){"use strict";var n=s("18f0"),i=s.n(n);i.a},"7aff":function(t,e,s){"use strict";var n=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"head-wrapper"},[s("div",{staticClass:"head-left",on:{click:t.leftClick}},[t._t("left")],2),s("div",{staticClass:"title"},[t._t("default",[t._v(t._s(t.title))])],2),s("div",{staticClass:"head-right",on:{click:t.rightClick}},[t._t("right")],2)])},i=[],a={props:{title:{type:String,default:""}},methods:{leftClick:function(){this.$emit("leftClick")},rightClick:function(){this.$emit("rightClick")}}},r=a,o=(s("b019"),s("2877")),l=Object(o["a"])(r,n,i,!1,null,"595ca198",null);e["a"]=l.exports},"88b4":function(t,e,s){"use strict";var n=s("33a9"),i=s.n(n);i.a},b019:function(t,e,s){"use strict";var n=s("b8d1"),i=s.n(n);i.a},b8d1:function(t,e,s){},f157:function(t,e,s){"use strict";s.r(e);var n=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"message-wrapper"},[s("nav-head",{attrs:{title:t.title},on:{leftClick:t.handleAvatarClick,rightClick:t.onAdd},scopedSlots:t._u([{key:"left",fn:function(){return[s("div",{staticClass:"l-head"},[s("avatar",{attrs:{imgurl:t.user.avatar}})],1)]},proxy:!0},{key:"right",fn:function(){return[s("div",{staticClass:"r-head"},[s("i",{staticClass:"iconfont icon-icon_add"})])]},proxy:!0}])}),s("div",{staticClass:"message-content"},[s("cube-scroll",{ref:"scroll",attrs:{data:t.message,options:t.scrollOptions,"scroll-events":["scroll"]},on:{"pulling-down":t.onPullingDown,scroll:t.onScrollHandle},scopedSlots:t._u([{key:"pulldown",fn:function(e){return[e.pullDownRefresh?s("div",{staticClass:"cube-pulldown-wrapper",style:t.pullDownStyle},[s("div",{staticClass:"pulldown-content"},[e.beforePullDown?s("div",[s("span",{class:t.pullDownY>40?"rotate arrow":"arrow"},[t._v("↓")]),s("span",[t._v(t._s(t.pullDownTip))])]):s("div",[e.isPullingDown?s("div",[s("cube-loading",{staticClass:"load",attrs:{size:18}}),s("span",[t._v("正在刷新")])],1):s("div",[s("span",[t._v("刷新成功")])])])])]):t._e()]}}])},[s("div",{staticClass:"inner-content"},[s("cube-swipe",[s("div",{staticClass:"search-wrapper"},[s("input",{staticClass:"search iconfont icon-search",attrs:{type:"text",placeholder:t.placeholder}})]),t.sessionList.length?s("ul",{staticClass:"chat-list"},t._l(t.sessionList,(function(e,n){return s("li",{key:e._id,staticClass:"item"},[s("cube-swipe-item",{ref:"swipeItem",refInFor:!0,attrs:{btns:t.swipeBtns,index:n,autoShrink:!0},on:{"btn-click":t.onBtnClick}},[s("div",{on:{click:function(s){return t.onItemClick(e.personInfo,e.newMsgCount)}}},[s("list-item",{attrs:{avatar:e.personInfo.avatar,name:e.personInfo.nickname,desc:e.lastMessage,uid:e.chatId},scopedSlots:t._u([{key:"extra",fn:function(){return[s("div",{staticClass:"extend"},[s("div",{staticClass:"time"},[t._v(" "+t._s(e.lastMsgTime)+" ")]),e.newMsgCount?s("div",[s("spot",{attrs:{count:e.newMsgCount}})],1):t._e()])]},proxy:!0}],null,!0)})],1)])],1)})),0):s("div",{staticClass:"no-content"},[t._v(" 暂时还没有新消息 ")])])],1)])],1),s("add-panel",{ref:"addPanel"}),s("side-bar",{ref:"sideBar"})],1)},i=[],a=(s("c740"),s("fb6a"),s("a434"),s("96cf"),s("1da1")),r=s("5530"),o=s("1d1c"),l=s("7aff"),c=s("6cc5"),u=s("c656"),d=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("transition",{on:{"before-enter":t.beforeEnter,enter:t.enter,"after-enter":t.afterEnter,leave:t.leave}},[t.isShow?s("div",{staticClass:"add-panel"},[s("div",{ref:"mask",staticClass:"add-panel-mask",on:{click:t.hide}}),s("div",{ref:"container",staticClass:"add-panel-container"},[s("ul",{staticClass:"add-panel-list"},t._l(t.addOptionList,(function(e,n){return s("li",{key:e.id,staticClass:"add-panel-list-item",class:{active:t.currentIndex===n},on:{click:function(s){return s.preventDefault(),t.selectItem(e)},touchstart:function(e){return t.start(n)},touchend:t.end}},[t._v(" "+t._s(e.label)+" ")])})),0)])]):t._e()])},f=[],h={data:function(){return{isShow:!1,list:[],currentIndex:-1,addOptionList:[{id:1,label:"创建群聊"},{id:2,label:"添加好友"},{id:3,label:"匹配聊天"},{id:4,label:"一起派对"},{id:5,label:"扫一扫"},{id:6,label:"更多"}]}},methods:{show:function(){this.isShow=!0},hide:function(){this.isShow=!1},selectItem:function(t){"添加好友"===t.label?this.$router.push({path:"/search"}):this.$createDialog({type:"alert",title:"尚未开发",icon:"cubeic-question"}).show()},start:function(t){this.currentIndex=t},end:function(){this.currentIndex=-1},beforeEnter:function(){this.$refs.mask.style.opacity="0",this.$refs.container.style.transform="scale(0)"},enter:function(t,e){this._reflow=t.offsetHeight,this.$refs.mask.style.opacity="0.4",this.$refs.container.style.transform="scale(1)",this.$refs.mask.style.transition="all 0.5s ease",this.$refs.container.style.transition="all 0.5s ease",this.$refs.mask.addEventListener("transitionend",e),this.$refs.container.addEventListener("transitionend",e)},afterEnter:function(){this.$refs.mask.style.transition="",this.$refs.container.style.transition=""},leave:function(t,e){this.$refs.mask.style.transition="all 0.5s ease",this.$refs.container.style.transition="all 0.5s ease",this.$refs.mask.style.opacity="0",this.$refs.container.style.transform="scale(0)",this.$refs.mask.addEventListener("transitionend",e),this.$refs.container.addEventListener("transitionend",e)}}},p=h,v=(s("016b"),s("2877")),m=Object(v["a"])(p,d,f,!1,null,"57701c64",null),w=m.exports,b=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("transition",{on:{"before-enter":t.beforeEnter,enter:t.enter,"after-enter":t.afterEnter,leave:t.leave}},[t.isShow?s("div",{staticClass:"sideBar"},[s("div",{ref:"mask",staticClass:"sideBar-mask",on:{click:t.hide}}),s("div",{ref:"menu",staticClass:"sideBar-menu"},[s("div",{staticClass:"sideBar-menu-top"},[s("div",{staticClass:"avatar-wrapper"},[s("avatar",{attrs:{imgurl:t.user.avatar}})],1),s("div",{staticClass:"description-wrapper"},[s("p",{staticClass:"username"},[t._v(t._s(t.user.nickname))]),s("p",{staticClass:"signature"},[t._v(t._s(t.user.desc))])])]),s("div",{staticClass:"sideBar-menu-list"},[s("div",{staticClass:"edit-item",on:{click:t.editInformation}},[s("span",[t._v("编辑资料")]),s("span",{staticClass:"iconfont icon-arrow-right"})])]),s("div",{staticClass:"exit-btn"},[s("span",{staticClass:"iconfont icon-tuichu"}),s("span",{staticClass:"exit",on:{click:t.exit}},[t._v(" 退出登录 ")])])])]):t._e()])},C=[],g=s("2b61"),y=s("2f62"),$={data:function(){return{isShow:!1}},components:{Avatar:c["a"]},computed:Object(r["a"])({},Object(y["b"])(["user"])),methods:{show:function(){this.isShow=!0},hide:function(){this.isShow=!1},beforeEnter:function(){this.$refs.mask.style.opacity="0",this.$refs.menu.style.transform="translate3d(-100%,0,0)"},enter:function(t,e){this._reflow=t.offsetHeight,this.$refs.mask.style.opacity="0.4",this.$refs.menu.style.transform="translate3d(0,0,0)",this.$refs.mask.style.transition="all 0.5s ease",this.$refs.menu.style.transition="all 0.5s ease",this.$refs.mask.addEventListener("transitionend",e),this.$refs.menu.addEventListener("transitionend",e)},afterEnter:function(){this.$refs.mask.style.transition="",this.$refs.menu.style.transition=""},leave:function(t,e){this.$refs.mask.style.transition="all 0.5s ease",this.$refs.menu.style.transition="all 0.5s ease",this.$refs.mask.style.opacity="0",this.$refs.menu.style.transform="translate3d(-100%,0,0)",this.$refs.mask.addEventListener("transitionend",e),this.$refs.menu.addEventListener("transitionend",e)},editInformation:function(){this.$router.push({path:"edit"})},exit:function(){var t=this;this.$createDialog({type:"confirm",title:"是否退出登录?",content:"退出后将需要重新登录",confirmBtn:{text:"确定退出",active:!0},cancelBtn:{text:"取消",active:!1},onConfirm:function(){g["a"].$store.remove("currentAccount"),t.$router.push({name:"Login"})}}).show()}}},k=$,_=(s("7a1a"),Object(v["a"])(k,b,C,!1,null,"630d692a",null)),S=_.exports,x=s("7b2c"),I={data:function(){return{title:"消息",pullDownStyle:"",pullDownY:0,message:["1","2","3","4","5","6","7","8","9","10"],placeholder:" 搜索",scrollOptions:{pullDownRefresh:{threshold:40,stop:40,txt:"更新成功"}},addOptionList:[{id:1,label:"创建群聊"},{id:2,label:"添加好友"},{id:3,label:"匹配聊天"},{id:4,label:"一起派对"},{id:5,label:"扫一扫"},{id:6,label:"更多"}],swipeBtns:[{action:"top",text:"置顶",color:"#999"},{action:"delete",text:"删除",color:"#f00"}]}},computed:Object(r["a"])({pullDownTip:function(){return this.pullDownY<=40?"下拉刷新":"释放立即刷新"}},Object(y["b"])(["user","sessionList"])),components:{ListItem:o["a"],NavHead:l["a"],Avatar:c["a"],AddPanel:w,SideBar:S,Spot:u["a"]},created:function(){this.getSessionList()},mounted:function(){var t=this;this.$bus.$on("receiveNewMessage",(function(e){var s=e.chatId,n=e.content,i=e.fromUser,a=e.create,r=t.sessionList.slice(),o=r.findIndex((function(t){return t.chatId===s}));if(o>-1){var l=r[o];r.splice(o,1,{personInfo:i,lastMessage:n,lastMsgTime:Object(x["a"])(new Date(a).getTime()),chatId:s,newMsgCount:l.newMsgCount+1})}else r.unshift({personInfo:i,lastMessage:n,lastMsgTime:Object(x["a"])(new Date(a).getTime()),chatId:s,newMsgCount:1});t.setSessionList(r)}))},beforeDestroy:function(){this.$bus.$off("receiveNewMessage")},methods:Object(r["a"])({onPullingDown:function(){this.getSessionList()},onScrollHandle:function(t){this.pullDownY=t.y,this.pullDownY>0&&(this.pullDownStyle="top:".concat(t.y,"px"))},getSessionList:function(){var t=this;return Object(a["a"])(regeneratorRuntime.mark((function e(){var s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.$store.dispatch("querySessionList");case 2:s=e.sent,s.code,t.$refs.scroll.forceUpdate();case 5:case"end":return e.stop()}}),e)})))()},onBtnClick:function(t,e){var s=this.sessionList.slice(),n=s.splice(e,1)[0];"top"===t.action?s.unshift(n):this.$store.dispatch("deleteSession",{index:e,chatId:n.chatId}),this.setSessionList(s)},onItemClick:function(t,e){this.$router.push({name:"Chat",params:{personInfo:t,newMsgCount:e}})},handleAvatarClick:function(){this.$refs.sideBar.show()},onAdd:function(){this.$refs.addPanel.show()}},Object(y["c"])({setSessionList:"SET_SESSIONLIST"}))},L=I,E=(s("88b4"),Object(v["a"])(L,n,i,!1,null,"6b27f2eb",null));e["default"]=E.exports},f38d:function(t,e,s){}}]);
//# sourceMappingURL=message.d54ff56f.js.map